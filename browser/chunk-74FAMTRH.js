import{ia as c}from"./chunk-JJWXYU2O.js";import{g as r,ga as n,ma as i}from"./chunk-GQVS24Z7.js";var f=(()=>{class t{constructor(){this.supabase=i(c).supabase}sendMessage(s){return r(this,null,function*(){try{let{data:e,error:a}=yield this.supabase.from("contacts").insert({name:s.name,email:s.email,subject:s.subject,message:s.message,status:"unread",createdAt:new Date().toISOString()}).select().single();if(a)return console.error("Error saving contact:",a),{success:!1,message:"Failed to send message: "+a.message};let o=yield this.sendEmailNotification(s);return o.success||console.warn("Email notification failed, but message was saved:",o.error),{success:!0,message:"Message sent successfully! We'll get back to you soon."}}catch(e){return console.error("Contact error:",e),{success:!1,message:"Error: "+e.message}}})}sendEmailNotification(s){return r(this,null,function*(){try{let{data:e,error:a}=yield this.supabase.functions.invoke("send-email",{body:{type:"contact",name:s.name,email:s.email,subject:s.subject,message:s.message}});return a?(console.error("Email notification error:",a),{success:!1,error:a.message}):(console.log("Email notification sent:",e),{success:!0})}catch(e){return console.error("Email send error:",e),{success:!1,error:e.message}}})}getAllMessages(){return r(this,null,function*(){let{data:s,error:e}=yield this.supabase.from("contacts").select("*").order("createdAt",{ascending:!1});return e?(console.error("Error fetching contacts:",e),[]):s})}markAsRead(s){return r(this,null,function*(){let{error:e}=yield this.supabase.from("contacts").update({status:"read"}).eq("id",s);e&&console.error("Error marking as read:",e)})}markAsReplied(s){return r(this,null,function*(){let{error:e}=yield this.supabase.from("contacts").update({status:"replied",repliedAt:new Date().toISOString()}).eq("id",s);e&&console.error("Error marking as replied:",e)})}deleteMessage(s){return r(this,null,function*(){let{error:e}=yield this.supabase.from("contacts").delete().eq("id",s);e&&console.error("Error deleting message:",e)})}getUnreadCount(){return r(this,null,function*(){let{count:s,error:e}=yield this.supabase.from("contacts").select("id",{count:"exact"}).eq("status","unread");return e?(console.error("Error getting unread count:",e),0):s||0})}static{this.\u0275fac=function(e){return new(e||t)}}static{this.\u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{f as a};
